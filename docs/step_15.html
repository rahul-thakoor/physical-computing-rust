<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Analogue inputs - Physical Computing with Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <noscript>
            <style type="text/css">
                .javascript-only {
                    display: none;
                }
            </style>
        </noscript>

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme;
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="step_1.html"><strong aria-hidden="true">1.</strong> Physical Computing with Rust</a></li><li><a href="step_2.html"><strong aria-hidden="true">2.</strong> What you will need</a></li><li><a href="step_3.html"><strong aria-hidden="true">3.</strong> GPIO pins</a></li><li><a href="step_4.html"><strong aria-hidden="true">4.</strong> Lighting an LED</a></li><li><a href="step_5.html"><strong aria-hidden="true">5.</strong> Switching an LED on and off</a></li><li><a href="step_6.html"><strong aria-hidden="true">6.</strong> Flashing an LED</a></li><li><a href="step_7.html"><strong aria-hidden="true">7.</strong> Using buttons to get input</a></li><li><a href="step_8.html"><strong aria-hidden="true">8.</strong> Manually controlling the LED</a></li><li><a href="step_9.html"><strong aria-hidden="true">9.</strong> Making a switch</a></li><li><a href="step_10.html"><strong aria-hidden="true">10.</strong> Using a buzzer</a></li><li><a href="step_11.html"><strong aria-hidden="true">11.</strong> Making traffic lights</a></li><li><a href="step_12.html"><strong aria-hidden="true">12.</strong> Using a light-dependent resistor</a></li><li><a href="step_13.html"><strong aria-hidden="true">13.</strong> Using a PIR sensor</a></li><li><a href="step_14.html"><strong aria-hidden="true">14.</strong> Using an ultrasonic distance sensor</a></li><li><a href="step_15.html" class="active"><strong aria-hidden="true">15.</strong> Analogue inputs</a></li><li><a href="step_16.html"><strong aria-hidden="true">16.</strong> Using motors</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons javascript-only">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Physical Computing with Rust</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </div>
                <div id="searchresults-outer" class="searchresults-outer">
                    <div class="searchresults-header" id="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="step_15.html#analogue-inputs" id="analogue-inputs"><h2>Analogue inputs</h2></a>
<p>The Raspberry Pi's GPIO pins are digital pins, so you can only set outputs to high or low, or read inputs as high or low. However, using an ADC chip (Analogue-to-Digital converter), you can read the value of analogue input devices such as potentiometers.</p>
<a class="header" href="step_15.html#spi" id="spi"><h3>SPI</h3></a>
<p>The analogue values are communicated to the Pi using the SPI protocol. While this will work in GPIO Zero out of the box, you may get better results if you enable full SPI support.</p>
<ul>
<li>
<p>Open a terminal window and install the <code>spidev</code> package:</p>
<pre><code class="language-bash">sudo apt-get install python3-spidev python-spidev
</code></pre>
</li>
<li>
<p>Open the <strong>Raspberry Pi Configuration</strong> dialogue from the main menu and enable <strong>SPI</strong> in the <strong>Interfaces</strong> tab:</p>
<p><img src="images/rcgui.png" alt="Enable SPI" /></p>
</li>
<li>
<p>Click <strong>OK</strong> and reboot the Pi.</p>
</li>
</ul>
<a class="header" href="step_15.html#wiring-the-adc-mcp3008" id="wiring-the-adc-mcp3008"><h3>Wiring the ADC (MCP3008)</h3></a>
<p>The MCP3008 is an ADC providing eight input channels. The eight connectors on one side are connected to the Pi's GPIO pins, and the other eight are available to connect analogue input devices to read their values.</p>
<p>Place the MCP3008 chip on a breadboard and carefully wire it up as shown in the following diagram. You should see a small notch, or dot, in one end of the chip. In the diagram, this end of the chip is alligned with column <strong>19</strong> on the breadboard.</p>
<p><img src="images/mcp3008.png" alt="MCP3008 wiring" /></p>
<p>Alternatively, you could use the <a href="http://rasp.io/analogzero/">Analog Zero</a> board, which provides the MCP3008 chip on a handy add-on board to save you from the complicated wiring.</p>
<a class="header" href="step_15.html#add-a-potentiometer" id="add-a-potentiometer"><h3>Add a potentiometer</h3></a>
<p>Now that the ADC is connected to the Pi, you can wire devices up to the input channels. A potentiometer is a good example of an analogue input device: it's simply a variable resistor, and the Pi reads the voltage (from 0V to 3.3V).</p>
<p><img src="images/potentiometer.jpg" alt="Potentiometer" /></p>
<p>A potentiometer's pins are ground, data, and 3V3. This means you connect it to ground and a supply of 3V3, and read the actual voltage from the middle pin.</p>
<ul>
<li>
<p>Place a potentiometer on the breadboard and wire one side to the ground rail, the other to the 3V3 rail, and the middle pin to the first input channel as shown:</p>
<p><img src="images/mcp3008-pot.png" alt="Add a potentiometer" /></p>
</li>
</ul>
<a class="header" href="step_15.html#code" id="code"><h3>Code</h3></a>
<p>Now your potentiometer is connected and its value can be read from Python!</p>
<ul>
<li>
<p>Open <strong>Python 3</strong> from the main menu.</p>
</li>
<li>
<p>In the shell, start by importing the <code>MCP3008</code> class from the GPIO Zero library:</p>
<pre><code class="language-python">from gpiozero import MCP3008
</code></pre>
</li>
<li>
<p>Create an object representing your analogue device:</p>
<pre><code class="language-python">pot = MCP3008(0)
</code></pre>
<p>Note the <code>0</code> represents the ADC's channel 0. There are 8 channels (0 to 7), and you're using the first one.</p>
</li>
<li>
<p>Try to read its value:</p>
<pre><code class="language-python">print(pot.value)
</code></pre>
<p>You should see a number between 0 and 1. This represents how far the dial is turned.</p>
</li>
<li>
<p>Now read the value in a loop:</p>
<pre><code class="language-python">while True:
    print(pot.value)
</code></pre>
<p>Try twisting the dial around to see the value change.</p>
</li>
</ul>
<a class="header" href="step_15.html#pwmled" id="pwmled"><h3>PWMLED</h3></a>
<p>Now you've tested you can read values from the potentiometer, you should connect it to another GPIO device.</p>
<ul>
<li>
<p>Add an LED to your breadboard and wire it to the Pi, connecting it to GPIO pin 21:</p>
<p><img src="images/mcp3008-pot-led.png" alt="Add LED" /></p>
</li>
<li>
<p>In your Python code, start by importing the <code>PWMLED</code> class:</p>
<pre><code class="language-python">from gpiozero import PWMLED
</code></pre>
<p>The <code>PWMLED</code> class lets you control the brightness of an LED using PWM, or pulse-width modulation.</p>
</li>
<li>
<p>Create a <code>PWMLED</code> object on pin 21:</p>
<pre><code class="language-python">led = PWMLED(21)
</code></pre>
</li>
<li>
<p>Test you can control the LED manually:</p>
<pre><code class="language-python">led.on()  # the led should be lit
led.off()  # the led should go off
led.value = 0.5  # the led should be lit at half brightness
</code></pre>
</li>
<li>
<p>Now connect the LED to the potentiometer:</p>
<pre><code class="language-python">led.source = pot.values
</code></pre>
</li>
<li>
<p>Turn the dial to change the LED brightness!</p>
</li>
</ul>
<a class="header" href="step_15.html#source-and-values" id="source-and-values"><h3>Source and values</h3></a>
<p>GPIO Zero has a powerful feature: <strong>source and values</strong>. Every device has a <code>value</code> property (the current value) and a <code>values</code> property (a stream of the device's values at all times). Every output device has a <code>source</code> property which can be used to set what the device's value should be.</p>
<ul>
<li><code>pot.value</code> gives the potentiometer's current value (it's read only, as it's an input device)</li>
<li><code>led.value</code> is the LED's current value (it's read/write: you can see what it is, and you can change it)</li>
<li><code>pot.values</code> is a generator constantly yielding the potentiometer's current value</li>
<li><code>led.source</code> is a way of setting where the LED gets its values from</li>
</ul>
<p>Rather than continuously setting the value of the LED to the value of the potentiometer in a loop, you can just pair the two devices. Therefore the line <code>led.source = pot.values</code> is equivalent to the following loop:</p>
<pre><code class="language-python">while True:
    led.value = pot.value
</code></pre>
<a class="header" href="step_15.html#multiple-potentiometers" id="multiple-potentiometers"><h3>Multiple potentiometers</h3></a>
<ul>
<li>
<p>Add a second potentiometer to your breadboard and connect it to the ADC's channel 1:</p>
<p><img src="images/mcp3008-2pots-led.png" alt="Second potentiometer" /></p>
</li>
<li>
<p>Now create a second <code>MCP3008</code> object on channel 1:</p>
<pre><code class="language-python">pot2 = MCP3008(1)
</code></pre>
</li>
<li>
<p>Make the LED blink:</p>
<pre><code class="language-python">led.blink()
</code></pre>
<p>The LED will blink continuously, one second on and one second off.</p>
</li>
<li>
<p>Change the <code>on_time</code> and <code>off_time</code> parameters to make it blink faster or slower:</p>
<pre><code class="language-python">led.blink(on_time=2, off_time=2)
led.blink(on_time=0.5, off_time=0.1)
</code></pre>
</li>
<li>
<p>Now use a loop to change the blink times according to the potentiometer values:</p>
<pre><code class="language-python">while True:
    print(pot.value, pot2.value)
    led.blink(on_time=pot.value, off_time=pot2.value, n=1, background=False)
</code></pre>
<p>Note you have to make it blink once in the foreground, so that each iteration gets time to finish before it updates the blink times.</p>
</li>
<li>
<p>Rotate the dials to make it blink at different speeds!</p>
</li>
<li>
<p>Also try changing <code>blink</code> to <code>pulse</code> and change <code>on_time</code> and <code>off_time</code> to <code>fade_in_time</code> and <code>fade_out_time</code> so that it fades in and out at different speeds, rather than just blinking on and off:</p>
<pre><code class="language-python">while True:
    print(pot.value, pot2.value)
    led.pulse(fade_in_time=pot.value, fade_out_time=pot2.value, n=1, background=False)
</code></pre>
</li>
<li>
<p>Rotate the dials to change the effect.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="step_14.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="step_16.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="step_14.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="step_16.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if (getComputedStyle(document.querySelector(".fa")).fontFamily !== "FontAwesome") {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '_FontAwesome/css/font-awesome.css';
                document.head.insertBefore(link, document.head.firstChild)
            }
        </script>

        

        

        

        
        <script src="searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
